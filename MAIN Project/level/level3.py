import objects,map_tools,status,crate,npc,sys,os,_loc,danger
sys.path.append(os.path.join(os.path.dirname(__file__),'..'))
from ursina.shaders import *
from ursina import *

mt=map_tools
o=objects
st=status
dg=danger
LC=_loc
c=crate
n=npc
U=-3

def map_setting():
	LC.FOG_L_COLOR=color.rgb32(25,45,25)
	LC.FOG_B_COLOR=color.rgb32(25,45,25)
	LC.SKY_BG_COLOR=color.rgb32(140,0,60)
	LC.AMB_M_COLOR=color.rgb32(240,200,170)
	LC.LV_DST=(16,20)
	LC.BN_DST=(5,20)
	LC.RCX=12
	LC.RCB=6
	LC.RCZ=32
	st.toggle_thunder=False
	st.toggle_rain=False

def start_load():
	load_crate()
	bonus_zone()
	load_object()
	load_wumpa()
	load_npc()
	map_setting()

def load_object():
	o.StartRoom(pos=(0,0,-32.2))
	o.BonusPlatform(pos=(.85,1.3,.85*8))
	o.InvWall(pos=(-2.5,0,20),sca=(.5,15,140))
	o.InvWall(pos=(2.5,0,20),sca=(.5,15,140))
	#temple
	o.ObjType_Scene(ID=4,pos=(2.55,-.3,-1.4),sca=.025,ro_y=90)
	o.ObjType_Scene(ID=4,pos=(-2.55,-.3,-1.4),sca=(-.025,.025,.025),ro_y=-90)
	o.ObjType_Scene(ID=4,pos=(2.55,-.3,56.4),sca=.025,ro_y=90)
	o.ObjType_Scene(ID=4,pos=(-2.55,-.3,56.4),sca=(-.025,.025,.025),ro_y=-90)
	#tree
	o.ObjType_Deco(ID=1,pos=(-2.3,2.2,82.5),sca=.0175,rot=(-90,0,0))
	o.ObjType_Deco(ID=1,pos=(2.3,2.2,82.5),sca=.0175,rot=(-90,0,0))
	o.ObjType_Deco(ID=1,pos=(-3,2.8,84),sca=.0175,rot=(-90,0,0))
	o.ObjType_Deco(ID=1,pos=(2.4,2.8,84),sca=.0175,rot=(-90,0,0))
	o.ObjType_Deco(ID=0,pos=(-1,4.2,82),sca=2,rot=(0,0,0),col=color.rgb32(0,170,0))
	o.ObjType_Deco(ID=0,pos=(0,4.5,82.1),sca=2,rot=(0,0,0),col=color.rgb32(0,170,0))
	o.ObjType_Deco(ID=0,pos=(1,4.2,82.11),sca=2,rot=(0,0,0),col=color.rgb32(0,170,0))
	#stage
	o.ObjType_Floor(ID=1,pos=(0,.2,-20),sca=.03,rot=(-90,90,0),col=color.rgb32(100,100,0))
	o.ObjType_Floor(ID=1,pos=(0,.2,-10),sca=.03,rot=(-90,90,0),col=color.rgb32(100,100,0))
	o.ObjType_Floor(ID=1,pos=(0,2,60),sca=.03,rot=(-90,90,0),col=color.rgb32(100,100,0))
	#platforms
	o.ObjType_Movable(ID=0,pos=(0,-.5,-24.8),ptm=2,ptw=1.5)
	o.ObjType_Movable(ID=0,pos=(0,-.5,-23.25),ptm=1,ptw=1.5,pts=3)
	o.ObjType_Movable(ID=0,pos=(0,-.1,-1.3),ptm=0)
	o.ObjType_Movable(ID=0,pos=(0,-.5,-7),ptm=0)
	o.ObjType_Movable(ID=0,pos=(0,.5,0),ptm=0)
	o.ObjType_Movable(ID=0,pos=(-.3,.5,11.5),ptm=2,ptw=1.5)
	o.ObjType_Movable(ID=0,pos=(-.85,.5,52.5),ptm=3,ptw=1.5)
	o.ObjType_Movable(ID=0,pos=(.85,.5,52.5),ptm=0)
	o.ObjType_Movable(ID=0,pos=(0,.75,56.5),ptm=0)
	o.ObjType_Movable(ID=0,pos=(0,1.5,77.3),ptm=3,ptw=1.5)
	#blocks
	tH=-.2
	#e0
	o.spw_block(p=(0,tH,-29),vx=[1,1],ID=2)
	o.ObjType_Floor(ID=2,pos=(0,tH,-27.3),rot=(0,0,0),sca=.35)
	o.spw_block(p=(-1,tH,-17),vx=[3,1],ID=2)
	o.ObjType_Floor(ID=2,pos=(0,tH,-14.5),rot=(0,0,0),sca=.35)
	o.spw_block(p=(0,tH,-5),vx=[1,4],ID=2)
	#e1
	nh=1.09
	o.spw_block(ID=2,p=(.85,tH+nh,0),vx=[1,6])
	o.spw_block(ID=2,p=(-.85,tH+nh,2),vx=[1,1])
	o.spw_block(ID=2,p=(-.85,tH+nh,.85*5),vx=[2,1])
	o.spw_block(ID=2,p=(-.85,tH+nh,.85*5),vx=[1,8])
	o.spw_block(ID=2,p=(0,tH+nh,.85*8),vx=[2,1])
	o.spw_block(ID=2,p=(0,tH+nh,13),vx=[1,3])
	o.ObjType_Block(ID=2,pos=(0,tH+nh,17),sca=.35)
	o.ObjType_Block(ID=2,pos=(0,tH+nh,19),sca=.35)
	o.spw_block(ID=2,p=(-.85,tH+nh,23),vx=[2,1])
	o.spw_block(ID=2,p=(0,tH+nh,26),vx=[2,1])
	o.spw_block(ID=2,p=(-.85,tH+nh,29),vx=[2,1])
	o.spw_block(ID=2,p=(0,tH+nh,32),vx=[1,2])
	o.ObjType_Floor(ID=2,pos=(0,tH+nh,41.3),rot=(0,0,0),sca=.35)
	o.spw_block(ID=2,p=(.85,tH+nh,40.5+.85*4),vx=[1,3])
	o.spw_block(ID=2,p=(-.85,tH+nh,40.5+.85*7),vx=[3,1])
	o.spw_block(ID=2,p=(-.85,tH+nh,40.5+.85*8),vx=[1,4])
	#e3
	lb=1.79
	o.spw_block(ID=2,p=(0,1.72,57.4),vx=[1,1])
	o.spw_block(ID=2,p=(0,lb,66.5),vx=[1,3])
	o.spw_block(ID=2,p=(0,lb,66.5+.85*7),vx=[1,4])
	o.spw_block(ID=2,p=(0,lb,80),vx=[1,5])
	o.spw_block(ID=2,p=(.85,lb,80+.85),vx=[1,1])
	#cobblestones underwater
	for cbb in range(2):
		o.ObjType_Deco(ID=6,pos=(0,0-cbb/7,-16+cbb*44.4),sca=(2,3,.75),rot=(-90,0,0))
		o.ObjType_Deco(ID=6,pos=(0,.9-cbb/7,22+cbb*44.4),sca=(2,3,.75),rot=(-90,0,0))
		o.ObjType_Deco(ID=6,pos=(0,1.9-cbb/7,79.5+cbb*44.4),sca=(2,3,.75),rot=(-90,0,0))
	del cbb
	#waterflow
	o.ObjType_Water(ID=1,pos=(0,-.3,-16),sca=(5,32),col=color.rgb32(170,170,170),rot=(0,0,0),al=.65,frames=3,spd=10)
	o.ObjType_Water(ID=1,pos=(0,.7,30),sca=(5,62),col=color.rgb32(170,170,170),rot=(0,0,0),al=.65,frames=3,spd=10)
	o.ObjType_Water(ID=1,pos=(0,1.7,73),sca=(5,32),col=color.rgb32(170,170,170),rot=(0,0,0),al=.65,frames=3,spd=10)
	#waterfall
	o.ObjType_Water(ID=2,pos=(0,.2,-1),sca=(5,1),frames=31,rot=(0,0,0),spd=8,al=1)
	o.ObjType_Water(ID=2,pos=(0,1.2,57),sca=(5,1),frames=31,rot=(0,0,0),spd=8,al=1)
	#scene
	sg=(.0225,.0265,.025)
	sr=(-.0225,.0265,.025)
	sh=color.gray
	o.ObjType_Scene(ID=3,pos=(-2.8,.3,-22),ro_y=-90,sca=sg,col=sh)
	o.ObjType_Scene(ID=3,pos=(2.8,.3,-22),ro_y=90,sca=sr,col=sh)
	o.ObjType_Scene(ID=3,pos=(-2.8,.3,-7),ro_y=-90,sca=sg,col=sh)
	o.ObjType_Scene(ID=3,pos=(2.8,.3,-7),ro_y=90,sca=sr,col=sh)
	o.ObjType_Scene(ID=3,pos=(-2.8,1.3,5),ro_y=-90,sca=sg,col=sh)
	o.ObjType_Scene(ID=3,pos=(2.8,1.3,5),ro_y=90,sca=sr,col=sh)
	o.ObjType_Scene(ID=3,pos=(-2.8,1.3,20),ro_y=-90,sca=sg,col=sh)
	o.ObjType_Scene(ID=3,pos=(2.8,1.3,20),ro_y=90,sca=sr,col=sh)
	o.ObjType_Scene(ID=3,pos=(-2.8,1.3,35),ro_y=-90,sca=sg,col=sh)
	o.ObjType_Scene(ID=3,pos=(2.8,1.3,35),ro_y=90,sca=sr,col=sh)
	o.ObjType_Scene(ID=3,pos=(-2.8,1.3,50),ro_y=-90,sca=sg,col=sh)
	o.ObjType_Scene(ID=3,pos=(2.8,1.3,50),ro_y=90,sca=sr,col=sh)
	o.ObjType_Scene(ID=3,pos=(-2.8,2.3,65),ro_y=-90,sca=sg,col=sh)
	o.ObjType_Scene(ID=3,pos=(2.8,2.3,65),ro_y=90,sca=sr,col=sh)
	o.ObjType_Scene(ID=3,pos=(-2.8,2.3,80),ro_y=-90,sca=sg,col=sh)
	o.ObjType_Scene(ID=3,pos=(2.8,2.3,80),ro_y=90,sca=sr,col=sh)
	o.EndRoom(pos=(1,3.7,88),c=color.rgb32(200,210,200))
	#Entity(model='quad',color=color.black,scale=(100,20),position=(0,-10,95))
	del sg,sr,sh
def load_crate():
	if not 5 in status.COLOR_GEM:
		c.place_crate(ID=16,p=(0,.24+.16,-21))
	#crate
	u0=.82
	mt.crate_wall(ID=1,POS=(.5,.1,-27.1),CNT=[1,2])
	mt.crate_wall(ID=1,POS=(-1.4,.24+.16,-21.6),CNT=[1,2])
	c.place_crate(ID=4,p=(1.2,.24+.16,-21.4))
	mt.crate_plane(ID=2,POS=(-.85,-.05+.16,-15),CNT=[1,2])
	mt.bounce_twin(POS=(1.6,.24+.16,-11.5),CNT=1)
	mt.crate_wall(ID=2,POS=(-.2,.16,-3.8),CNT=[2,1])
	mt.crate_wall(ID=1,POS=(.65,1.05+.16,2.5),CNT=[2,1])
	mt.crate_row(ID=1,POS=(0,u0,19.7),CNT=6,WAY=1)
	mt.crate_wall(ID=1,POS=(1.6,2.2,58.4),CNT=[1,3])
	mt.crate_wall(ID=14,POS=(.7,.125,-17),CNT=[1,2])
	c.place_crate(ID=14,p=(-.8,1.21,2))
	c.place_crate(ID=1,p=(0,u0,24.5))
	c.place_crate(ID=2,p=(0,u0,27.5))
	c.place_crate(ID=3,p=(0,u0+.32,27.5))
	c.place_crate(ID=1,p=(0,u0,30.5))
	c.place_crate(ID=2,p=(0,u0,34.5))
	c.place_crate(ID=3,p=(0,u0,35.5))
	c.place_crate(ID=1,p=(-1,u0,35.5))
	c.place_crate(ID=2,p=(-1,u0,36.5))
	c.place_crate(ID=1,p=(-1,u0,37.5))
	c.place_crate(ID=3,p=(0,u0,37.5))
	c.place_crate(ID=1,p=(0,u0,38.5))
	c.place_crate(ID=4,p=(0,u0,39.5))
	c.place_crate(ID=2,p=(-1.4,.24+.16,-11.5))
	mt.crate_plane(ID=1,POS=(-.4,u0,44),CNT=[2,3])
	mt.crate_plane(ID=1,POS=(.3,u0,48),CNT=[2,2])
	c.place_crate(ID=9,p=(1.3,1.16,52.4),m=1)
	for _c in range(10):
		c.place_crate(ID=13,p=(0,u0,52.4+.32*_c),m=1,l=0)
	mt.crate_plane(ID=1,POS=(0,1.8,70),CNT=[1,3])
	c.place_crate(ID=10,p=(.85,1.97+.16,80.85))
	mt.crate_wall(ID=1,POS=(-.175,1.05+.16,14.5),CNT=[2,1])
	mt.crate_row(ID=1,POS=(-.85,1.05+.16,40.4),CNT=2,WAY=1)
	c.place_crate(ID=7,p=(-1,2.04+.16,58.4))
	mt.crate_row(ID=1,POS=(-1,4.5,58.4),CNT=4,WAY=2)
	mt.bounce_twin(POS=(1,2.04+.16,58.4),CNT=1)
	#aku
	c.place_crate(ID=5,p=(-.85,1.05+.16,9.3))
	#checkpoints
	c.place_crate(ID=6,p=(0,.24+.16,-9.2))
	c.place_crate(ID=6,p=(0,1.05+.16,32.8))
	c.place_crate(ID=6,p=(.85,1.05+.16,44.6))
	c.place_crate(ID=6,p=(0,2.04+.16,58.5))
def load_wumpa():
	mt.wumpa_row(POS=(0,.15,-28.3),CNT=2,WAY=1)
	mt.wumpa_row(POS=(0,.44,-20.4),CNT=3,WAY=1)
	mt.wumpa_row(POS=(0,.44,-11),CNT=2,WAY=1)
	mt.wumpa_row(POS=(.9,1.25,-.2),CNT=3,WAY=1)
	mt.wumpa_row(POS=(-.8,1.25,5),CNT=4,WAY=1)
	mt.wumpa_row(POS=(0,1.18,19.7),CNT=2,WAY=1)
	mt.wumpa_row(POS=(.8,1.25,42.1),CNT=3,WAY=1)
	mt.wumpa_row(POS=(-.8,1.25,47.2),CNT=3,WAY=1)
	mt.wumpa_row(POS=(0,1.18,52.4),CNT=4,WAY=1)
	mt.wumpa_row(POS=(0,2.15,66.4),CNT=2,WAY=1)
	mt.wumpa_row(POS=(0,2.15,72.4),CNT=2,WAY=1)
	mt.wumpa_row(POS=(0,2.15,79.9),CNT=2,WAY=1)
	mt.wumpa_row(POS=(-.6,.44,-11.4),CNT=5,WAY=0)
	mt.wumpa_row(POS=(-.2,1.25,6.8),CNT=2,WAY=0)
	mt.wumpa_row(POS=(-.3,1.25,46.4),CNT=4,WAY=0)
	mt.wumpa_row(POS=(-.7,.15,-17),CNT=4,WAY=0)
	mt.wumpa_plane(POS=(.5,.15,-15.1),CNT=[1,3])
	mt.wumpa_plane(POS=(0,.15,-5.2),CNT=[1,3])
	mt.wumpa_plane(POS=(0,1.25,40.5),CNT=[3,3])
def load_npc():
	n.Hippo(POS=(0,1.8,64.7))
	n.Hippo(POS=(0,1.8,63))
	n.spawn(ID=7,POS=(-.85,1.05,29))
	n.spawn(ID=7,POS=(.85,1.05,25.8))
	n.spawn(ID=7,POS=(-.85,1.05,23))
	n.spawn(ID=7,POS=(0,1.05,41.4))
	n.spawn(ID=7,POS=(0,1.95,74.1))
	n.spawn(ID=2,POS=(0,1.05,4.2))

## bonus level / gem path
def bonus_zone():
	dg.FallingZone(pos=(0,-40,0),s=(64,1,64))
	o.ObjType_Background(ID=1,pos=(0,-45,34.9),sca=(100,20,.1),col=color.rgb32(100,140,100),txa=(7,1),UL=True)
	o.ObjType_Background(ID=1,pos=(0,-60,34.8),sca=(100,20,.1),col=color.rgb32(100,140,100),txa=(7,1),UL=True)
	o.ObjType_Background(ID=2,pos=(10,-40,35),sca=(80,35),col=color.rgb32(100,60,80),txa=(1,1),UL=True)
	mt.wumpa_double_row(POS=(12.8,-35,U),CNT=6)
	mt.wumpa_double_row(POS=(-.5,-36.5,U),CNT=4)
	mt.wumpa_row(POS=(1.5,-36.35,U),CNT=3,WAY=0)
	mt.wumpa_row(POS=(3.5,-35.35,U),CNT=3,WAY=0)
	mt.wumpa_row(POS=(5.5,-34.85,U),CNT=3,WAY=0)
	mt.wumpa_row(POS=(17.5,-35.35,U),CNT=3,WAY=0)
	o.ObjType_Floor(ID=3,pos=(2,-39,U+1.2),sca=.03,col=color.rgb32(150,170,150),rot=(-90,90,0))
	o.ObjType_Floor(ID=3,pos=(4,-39,U+1.2),sca=.03,col=color.rgb32(150,170,150),rot=(-90,90,0))
	o.ObjType_Floor(ID=3,pos=(6,-38.5,U+1.2),sca=.03,col=color.rgb32(150,170,150),rot=(-90,90,0))
	mt.crate_row(ID=0,POS=(-1,-37,U),WAY=0,CNT=7)
	mt.bounce_twin(POS=(7.2,-36,U),CNT=5,trs=1.65)
	o.ObjType_Floor(ID=3,pos=(9.5,-38.5,U+1.2),sca=.03,col=color.rgb32(150,170,150),rot=(-90,90,0))
	o.ObjType_Floor(ID=3,pos=(10.5,-38,U+1.2),sca=.03,col=color.rgb32(150,170,150),rot=(-90,90,0))
	o.ObjType_Floor(ID=3,pos=(11.5,-38,U+1.2),sca=.03,col=color.rgb32(150,170,150),rot=(-90,90,0))
	o.ObjType_Scene(ID=5,pos=(-5,-43,4),sca=.035,ro_y=90)
	o.ObjType_Scene(ID=5,pos=(8,-43,3.9),sca=.035,ro_y=90)
	o.ObjType_Scene(ID=5,pos=(21,-43,3.9),sca=.035,ro_y=90)
	o.ObjType_Scene(ID=5,pos=(-3,-44,6),sca=.035,ro_y=90)
	o.ObjType_Scene(ID=5,pos=(6,-44,5.9),sca=.035,ro_y=90)
	o.ObjType_Scene(ID=5,pos=(19,-44,6),sca=.035,ro_y=90)
	c.place_crate(ID=11,p=(12.5,-36,U))
	mt.crate_row(ID=12,POS=(12.82,-36,U),WAY=0,CNT=7)
	mt.crate_row(ID=1,POS=(12.82,-35.68,U),WAY=0,CNT=7)
	o.ObjType_Floor(ID=3,pos=(16,-38,U+1.2),sca=.03,col=color.rgb32(150,170,150),rot=(-90,90,0))
	o.ObjType_Floor(ID=3,pos=(18,-38,U+1.2),sca=.03,col=color.rgb32(150,170,150),rot=(-90,90,0))
	mt.crate_wall(ID=1,POS=(16,-35.65+.16,U+.1),CNT=[2,2])
	c.place_crate(ID=2,p=(4,-36.65+.16,U+.1))
	c.place_crate(ID=4,p=(5.8,-35.1,U))
	mt.crate_row(ID=2,POS=(10.4,-35.65+.16,U+.1),CNT=4,WAY=0)
	o.BonusPlatform(pos=(19.3,-35.7,U))