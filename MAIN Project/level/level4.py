import sys,os
import settings,objects,map_tools,crate,npc,status,item,random
sys.path.append(os.path.join(os.path.dirname(__file__), '..'))
from ursina import *

mtx='res/terrain/l4/metal_01.jpg'
b='box'

mt=map_tools
st=status
o=objects
c=crate
n=npc
U=-3


def start_load():
	load_crate()
	bonus_zone()
	if 5 in st.COLOR_GEM or settings.debg:
		gem_zone()
	load_object()
	load_wumpa()
	load_npc()

def load_object():
	sw_tile=mtx
	Entity(model='quad',color=color.black,scale=(300,200),z=100)
	o.StartRoom(pos=(0,.3,-64.2))
	o.FallingZone(pos=(0,-1,0),s=(128,.3,128))
	o.BonusPlatform(pos=(5.2,2,11))
	o.GemPlatform(pos=(4.2,2,31.7),t=5)
	o.EletricWater(pos=(0,.2,-48),sca=(8,96))
	o.EletricWater(pos=(14.5,3.5,83),sca=(8,64))
	o.Water(pos=(10,1,40),sca=(20,23),c=color.rgb32(100,255,0),a=1)
	o.Water(pos=(0,-1,6),sca=(30,10),c=color.rgb32(100,255,0),a=1)
	o.EndRoom(pos=(15.65,5.5,78.5),c=color.rgb32(200,200,200))
	#invisible walls
	o.InvWall(pos=(-2,0,-30),sca=(1,15,70))
	o.InvWall(pos=(2,0,-30),sca=(1,15,70))
	o.InvWall(pos=(3,2,35),sca=(1,15,50))
	o.InvWall(pos=(7,2,25),sca=(1,15,40))
	o.InvWall(pos=(12.7,4,64.6),sca=(1,15,30))
	o.InvWall(pos=(16.15,4,64.6),sca=(1,15,30))
	#tunnels
	o.SewerTunnel(pos=(0,.4,-53))
	o.SewerTunnel(pos=(0,.4,-44))
	o.SewerTunnel(pos=(0,.4,-35))
	o.SewerTunnel(pos=(0,.4,-26))
	o.SewerEscape(pos=(0,-1,-22.7))
	o.SewerEscape(pos=(0,-1,-13))
	o.SewerEscape(pos=(0,-1,-3.3))
	o.SewerEscape(pos=(5,1,12),typ=1)
	o.SewerEscape(pos=(5,1,21.7),typ=1)
	o.SewerTunnel(pos=(14.5,3.7,63))
	o.SewerTunnel(pos=(14.5,3.7,58))
	o.SewerTunnel(pos=(14.5,3.7,68))
	o.SewerTunnel(pos=(14.5,3.7,78))
	o.SewerPipe(pos=(2.9,0,9),typ=1)
	o.SewerPipe(pos=(2.9,-3.3,9),typ=1)
	o.SewerEntrance(pos=(.1,1,-25.1))
	o.SewerEntrance(pos=(5.2,2.75,9.7))
	o.SewerEntrance(pos=(5.2,2.75,8.7))
	o.SewerEntrance(pos=(5,2.75,29.3))
	o.SewerEntrance(pos=(14.5,4.75,49.7))
	o.DrippingWater(pos=(.08,2,-59),sca=(.5,.3))
	Entity(model='cube',scale=(16,1,96),position=(0,-.5,-48),collider=b,color=color.black)
	Entity(model='cube',scale=(4,.5,5),position=(0,.5,1.5),texture_scale=(4,5),collider=b,texture=mtx)
	Entity(model='cube',scale=(4,.5,5),position=(14.5,3.5,52.25),texture_scale=(4,5),collider=b,texture=mtx)
	Entity(model='cube',scale=(16,1,64),position=(14.5,2.9,83),collider=b,color=color.black)
	#walls
	Entity(model='quad',texture=sw_tile,scale=(10,20),texture_scale=(10,20),position=(-2,1,9),color=color.rgb32(160,150,150))
	Entity(model='quad',texture=sw_tile,scale=(20,20),texture_scale=(20,20),position=(3,1,49.7),color=color.rgb32(160,150,150))
	Entity(model='cube',texture=sw_tile,scale=(1,20,23),texture_scale=(10,20),position=(2,1,40),color=color.rgb32(160,150,150))
	Entity(model='cube',texture=sw_tile,scale=(1,20,16),texture_scale=(10,20),position=(8,1,37),color=color.rgb32(160,150,150))
	o.SewerWall(pos=(5.5,-3.5,9.2))
	o.SewerWall(pos=(9.5,0,9.2))
	o.SewerWall(pos=(15,-1,49.3))
	o.SewerWall(pos=(19.5,4,49.3))
	o.SewerPipe(pos=(-4,1,9),typ=2)
	o.SewerPipe(pos=(-2,1,9),typ=2)
	o.SewerPipe(pos=(0,1,9),typ=2)
	o.SewerPipe(pos=(2,1,9),typ=2)
	o.SewerPipe(pos=(-4,-.3,8.7),typ=0)
	o.SewerPipe(pos=(-2,-.3,8.7),typ=0)
	o.SewerPipe(pos=(0,-.3,8.7),typ=0)
	o.SewerPipe(pos=(2,-.3,8.7),typ=0)
	o.SewerPipe(pos=(4,3,49),typ=2)
	o.SewerPipe(pos=(6,3,49),typ=2)
	o.SewerPipe(pos=(8,3,49),typ=2)
	o.SewerPipe(pos=(10,3,49),typ=2)
	o.SewerPipe(pos=(4,1.5,49.4),typ=0)
	o.SewerPipe(pos=(6,1.5,49.4),typ=0)
	o.SewerPipe(pos=(8,1.5,49.4),typ=0)
	o.SewerPipe(pos=(10,1.5,49.4),typ=0)
	#platforms
	ph=.3
	pg=.65
	#e0
	o.SewerFloor(pos=(0,ph,-59.5))
	o.SewerFloor(pos=(0,ph,-45))
	o.SewerFloor(pos=(0,ph,-30))
	o.swr_multi_ptf(p=(-.9,ph,-23),cnt=[2,2])
	o.swr_multi_ptf(p=(-1,ph,-13),cnt=[1,2])
	o.swr_multi_ptf(p=(1.2,ph,-4),cnt=[1,2])
	#e1
	o.SewerFloor(pos=(0,pg,5.3))
	o.swr_multi_ptf(p=(-.5,pg,.5*16),cnt=[6,1])
	o.swr_multi_ptf(p=(3,pg+.4,.5*16),cnt=[2,1])
	o.swr_multi_ptf(p=(4,pg+.7,.5*16),cnt=[2,1])
	o.SewerFloor(pos=(5.1,pg+0.981,11))
	o.swr_multi_ptf(p=(5,pg+1,(.5*30)),cnt=[2,4])
	o.swr_multi_ptf(p=(5,pg+1,(.5*36)),cnt=[2,2])
	o.swr_multi_ptf(p=(5.5,pg+1,(.5*39)),cnt=[1,6])
	o.swr_multi_ptf(p=(4.5,pg+1,(.5*44)),cnt=[2,1])
	o.swr_multi_ptf(p=(4.5,pg+1,(.5*45)),cnt=[1,6])
	o.swr_multi_ptf(p=(4.5,pg+1,(.5*51)),cnt=[2,1])
	o.swr_multi_ptf(p=(5,pg+1,(.5*52)),cnt=[1,8])
	o.SewerFloor(pos=(5.1,pg+0.981,32.15))
	o.swr_multi_ptf(p=(4,pg+1,(.5*72)),cnt=[5,1])
	o.SewerFloor(pos=(5.1,pg+0.981,40))
	o.SewerFloor(pos=(5.1,pg+0.981,46-.2))
	o.swr_multi_ptf(p=(6,pg+1,(.5*97)),cnt=[4,1])
	o.swr_multi_ptf(p=(9,pg+1.5,(.5*97)),cnt=[2,1])
	o.swr_multi_ptf(p=(11,pg+1.5,(.5*97)),cnt=[2,1])
	o.swr_multi_ptf(p=(12.5,pg+2,(.5*97)),cnt=[1,1])
	o.swr_multi_ptf(p=(13.5,pg+2.5,(.5*97)),cnt=[1,1])
	o.swr_multi_ptf(p=(14.5,pg+3,(.5*97)),cnt=[1,3])
	#e2
	o.swr_multi_ptf(p=(14.5,pg+3,58),cnt=[2,2])
	o.swr_multi_ptf(p=(14,pg+3,66),cnt=[1,1])
	o.swr_multi_ptf(p=(13.5,pg+3,72.5),cnt=[5,3])
	#dangers
	o.SewerPipe(pos=(0,.9,.8),typ=3)
def load_crate():
	#crates
	mt.crate_wall(ID=1,POS=(.25,.56,-61),CNT=[2,1])
	mt.crate_wall(ID=1,POS=(.62,.16,-54.53),CNT=[1,2])
	mt.crate_wall(ID=2,POS=(0,.16,-44.05),CNT=[2,1])
	mt.crate_wall(ID=2,POS=(0,.56,-29.59-.32),CNT=[2,2])
	mt.crate_wall(ID=2,POS=(.65,.16,-22.05),CNT=[1,2])
	mt.crate_wall(ID=3,POS=(.77,.16,-7.70),CNT=[2,1])
	mt.crate_wall(ID=2,POS=(1.18,.56,-4.22),CNT=[1,2])
	#nitro
	c.place_crate(ID=12,p=(5.27,1.9,17))
	c.place_crate(ID=7,p=(5.27,1.9+.32,17))
	c.place_crate(ID=3,p=(5.27,4,17))
	c.place_crate(ID=12,p=(.78,.16,-52.2))
	c.place_crate(ID=14,p=(.7,.56,-45.1))
	c.place_crate(ID=12,p=(.52,.16,-37.2))
	c.place_crate(ID=12,p=(-.50,.16,-35.5))
	c.place_crate(ID=12,p=(.1,.16,-33.3))
	c.place_crate(ID=12,p=(.15,.56,-29.1-.32))
	c.place_crate(ID=12,p=(-.65,.56,-22.7))
	c.place_crate(ID=14,p=(.14,.16,-17.1))
	c.place_crate(ID=12,p=(.99,.16,-15.3))
	c.place_crate(ID=12,p=(-.21,.16,-9.75))
	c.place_crate(ID=12,p=(-.72,.16,-6.8))
	c.place_crate(ID=12,p=(-.38,.16,-4.2))
	c.place_crate(ID=12,p=(-.96,.91,-.1))
	c.place_crate(ID=12,p=(.08,.91,-.1))
	c.place_crate(ID=12,p=(1.08,.91,-.1))
	c.place_crate(ID=12,p=(4.49,1.6,8))
	c.place_crate(ID=12,p=(3.53,1.3,8))
	c.place_crate(ID=12,p=(4.96,1.9,15))
	c.place_crate(ID=12,p=(5.04,1.9,21.9))
	c.place_crate(ID=12,p=(13.62,3.56,56.1))
	c.place_crate(ID=12,p=(15.27,3.56,56.1))
	c.place_crate(ID=12,p=(14.59,3.56,61))
	c.place_crate(ID=12,p=(13.77,3.56,63.1))
	c.place_crate(ID=12,p=(15.22,3.56,64.9))
	c.place_crate(ID=10,p=(13.74,3.9,72.7))
	mt.crate_plane(ID=1,POS=(4.9,1.9,46),CNT=[2,2])
	mt.crate_wall(ID=2,POS=(14.7,3.9,58.32),CNT=[1,2])
	mt.crate_plane(ID=1,POS=(-.7,.9,2.2),CNT=[2,1])
	mt.crate_wall(ID=1,POS=(5.255,1.9,15.6),CNT=[2,1])
	mt.crate_plane(ID=14,POS=(5.759,1.9,31.59),CNT=[2,2])
	mt.crate_plane(ID=1,POS=(15.257,3.9,72.61),CNT=[2,2])
	#checkpoints
	c.place_crate(ID=6,p=(0,.56,-43))
	c.place_crate(ID=6,p=(0,.91,3.6))
	c.place_crate(ID=6,p=(5,1.9,30.4))
	c.place_crate(ID=6,p=(14.5,3.9,49.9))
	#aku
	c.place_crate(ID=5,p=(-.4,.56,-47.1))
	c.place_crate(ID=5,p=(.04,.9,6.4))
	c.place_crate(ID=5,p=(5,1.9,39.9))
	if not 2 in status.COLOR_GEM:
		c.place_crate(ID=16,p=(-.6,.56,-57.5))
def load_wumpa():
	mt.wumpa_row(POS=(-.5,.16+.2,-51.8),CNT=4,WAY=1)
	mt.wumpa_row(POS=(0,.56+.2,-45.6),CNT=5,WAY=1)
	mt.wumpa_row(POS=(.5,.16+.2,-26.6),CNT=3,WAY=1)
	mt.wumpa_row(POS=(-1.0,.56+.2,-13.1),CNT=2,WAY=1)
	mt.wumpa_row(POS=(0,.91+.2,4.4),CNT=2,WAY=1)
	mt.wumpa_row(POS=(5.2,1.91+.2,8.3),CNT=3,WAY=1)
	mt.wumpa_row(POS=(5.5,1.91+.2,18.9),CNT=2,WAY=1)
	mt.wumpa_row(POS=(4.5,1.91+.2,22),CNT=2,WAY=1)
	mt.wumpa_row(POS=(5,1.91+.2,25.4),CNT=3,WAY=1)
	mt.wumpa_row(POS=(5,1.91+.2,33.1),CNT=2,WAY=1)
	mt.wumpa_row(POS=(5,1.91+.2,44.5),CNT=3,WAY=1)
	mt.wumpa_row(POS=(14.5,3.91+.2,50.6),CNT=3,WAY=1)
	mt.wumpa_row(POS=(14.6,3.56+.2,62.7),CNT=2,WAY=1)
	mt.wumpa_row(POS=(-.5,.56,-60.8),CNT=3,WAY=0)
	mt.wumpa_row(POS=(0,.6,-30),CNT=3,WAY=0)
	mt.wumpa_row(POS=(-1,.6,-23.1),CNT=3,WAY=0)
	mt.wumpa_row(POS=(.5,.95,7.9),CNT=3,WAY=0)
	mt.wumpa_row(POS=(6,1.95,48.5),CNT=2,WAY=0)
	mt.wumpa_row(POS=(9,2.45,48.5),CNT=3,WAY=0)
	mt.wumpa_row(POS=(11.0,2.45,48.5),CNT=2,WAY=0)
def load_npc():
	n.spawn(ID=12,POS=(0,.25,-53.5))
	n.spawn(ID=12,POS=(0,.25,-35.5))
	n.spawn(ID=10,POS=(0,.4,-31.2))
	n.spawn(ID=12,POS=(0,.25,-16))
	n.spawn(ID=11,POS=(.75,.75,8),RTYP=0)
	n.spawn(ID=10,POS=(5.2,2.6,17),RTYP=2)
	n.spawn(ID=11,POS=(5.2,1.75,11),RTYP=1)
	n.spawn(ID=12,POS=(14.5,3.7,61.5))
	n.spawn(ID=10,POS=(14.5,3.75,52),RTYP=1)
	n.spawn(ID=11,POS=(4.9,1.75,36),RTYP=0)
	n.spawn(ID=11,POS=(4.9,1.75,40),RTYP=1)
	n.spawn(ID=13,POS=(5,2,14.6),DRC=1)
	n.spawn(ID=13,POS=(5.5,2,14.6),DRC=1)

## bonus level / gem path
def bonus_zone():
	o.FallingZone(pos=(0,-42,0),s=(64,1,64))
	#bg walls
	Entity(model='quad',texture='res/terrain/l4/sewer_tiles.jpg',scale=(60,20),texture_scale=(30,10),position=(0,-35,1),color=color.rgb32(160,150,150))
	#pipes
	o.SewerPipe(pos=(8.3,-36.4,U),typ=3)
	for swp in range(3):
		o.SewerPipe(pos=(2+swp*13,-34,.6),typ=2)
		o.SewerPipe(pos=(4.5+swp*13,-34,.6),typ=2)
		o.SewerPipe(pos=(7+swp*13,-34,.6),typ=2)
		o.SewerPipe(pos=(3+swp*13,-36,.6),typ=0)
		o.SewerPipe(pos=(6+swp*13,-36,.6),typ=0)
	for swl in range(3):
		o.SewerWall(pos=(-2+swl*13,-38,-.5))
		o.SewerWall(pos=(-2+swl*13,-30.8,-.5))
	#platform
	o.swr_multi_ptf(p=(0,-36.5,U),cnt=[3,1])
	o.swr_multi_ptf(p=(2,-36,U),cnt=[1,1])
	o.swr_multi_ptf(p=(3,-35.5,U),cnt=[4,1])
	o.swr_multi_ptf(p=(5,-34,U),cnt=[7,1])
	o.swr_multi_ptf(p=(9,-34,U),cnt=[3,1])
	o.swr_multi_ptf(p=(8.5,-36,U),cnt=[5,1])
	o.swr_multi_ptf(p=(12,-36,U),cnt=[3,1])
	o.swr_multi_ptf(p=(14,-35.5,U),cnt=[1,1])
	o.swr_multi_ptf(p=(15,-35,U),cnt=[1,1])
	o.swr_multi_ptf(p=(16,-34.5,U),cnt=[1,1])
	o.swr_multi_ptf(p=(17,-34.5,U),cnt=[4,1])
	o.swr_multi_ptf(p=(20,-34.5,U),cnt=[4,1])
	#crate
	c.place_crate(ID=4,p=(2,-35.9+.16,U))
	c.place_crate(ID=1,p=(2,-35.9+.48,U))
	c.place_crate(ID=7,p=(4.4,-35.4+.16,U))
	c.place_crate(ID=11,p=(4.4-.32,-35.4+.16,U))
	c.place_crate(ID=12,p=(5.57,-33.74,U))
	c.place_crate(ID=12,p=(6.49,-33.74,U))
	c.place_crate(ID=12,p=(7.45,-33.74,U))
	c.place_crate(ID=9,p=(10,-33.7,U),m=2)
	mt.crate_row(ID=13,POS=(6.1+(.32*3),-36,U),CNT=4,WAY=0,m=2,l=3)
	mt.crate_row(ID=2,POS=(12.5,-35.74,U),CNT=3,WAY=2)
	mt.crate_wall(ID=14,POS=(17.47,-34.24,U),CNT=[1,2])
	c.place_crate(ID=11,p=(21.2,-34.24,U))
	c.place_crate(ID=12,p=(12.97,-35.74,U))
	c.place_crate(ID=1,p=(12.97,-35.74+.32,U))
	c.place_crate(ID=12,p=(14.12,-35.24,U))
	c.place_crate(ID=2,p=(14.12,-35.24+.32,U))
	c.place_crate(ID=12,p=(14.97,-34.74,U))
	c.place_crate(ID=1,p=(14.97,-34.74+.32,U))
	c.place_crate(ID=12,p=(15.98,-34.24,U))
	c.place_crate(ID=1,p=(15.98,-34.24+.32,U))
	c.place_crate(ID=12,p=(16.97,-34.24,U))
	c.place_crate(ID=1,p=(16.97,-34.24+.32,U))
	#wumpa fruits
	mt.wumpa_double_row(POS=(.4,-36.24,U),CNT=3)
	mt.wumpa_double_row(POS=(3,-35.24,U),CNT=3)
	mt.wumpa_double_row(POS=(8.48,-35.74,U),CNT=4)
	mt.wumpa_double_row(POS=(20.02,-34.24,U),CNT=3)
	mt.wumpa_row(POS=(4.5,-34.6,U),CNT=4,WAY=2)
	mt.wumpa_row(POS=(12,-35.74,U),CNT=4,WAY=2)
	mt.wumpa_row(POS=(8.48,-35.3,U),CNT=4,WAY=2)
	o.BonusPlatform(pos=(22.3,-34.2,U))
def gem_zone():
	Entity(model='cube',scale=(16,1,96),position=(200,-1.2,-16),collider='box',color=color.black)
	o.InvWall(pos=(198,0,20),sca=(1,15,50))
	o.InvWall(pos=(202,0,20),sca=(1,15,50))
	o.InvWall(pos=(200,0,34),sca=(10,15,1))
	o.swr_multi_ptf(p=(199.75,-.4,-3.25),cnt=[2,2])
	o.EletricWater(pos=(200,-.5,22),sca=(8,64))
	o.SewerTunnel(pos=(200,-.3,5),c=color.rgb32(0,200,180))
	o.SewerTunnel(pos=(200,-.3,15),c=color.rgb32(0,200,180))
	o.SewerTunnel(pos=(200,-.3,25),c=color.rgb32(0,200,180))
	o.SewerEntrance(pos=(200,1,-3))
	o.SwimPlatform(pos=(200,-.45,-.7))
	o.SwimPlatform(pos=(200-.3,-.45,.7))
	o.SwimPlatform(pos=(200+.3,-.45,11.8))
	o.SwimPlatform(pos=(200,-.45,12.8))
	o.SwimPlatform(pos=(200-.3,-.45,13.8))
	o.SwimPlatform(pos=(200+.3,-.45,18.7))
	o.SwimPlatform(pos=(200,-.45,19.7))
	o.SwimPlatform(pos=(200-.3,-.45,20.7))
	#gem route crate
	c.place_crate(ID=0,p=(200,-.5,-2))
	c.place_crate(ID=0,p=(200,-.5,2))
	c.place_crate(ID=9,p=(200,-.5,3),m=101)
	c.place_crate(ID=13,p=(200,-.5,4),l=8,m=101)
	c.place_crate(ID=9,p=(200,-.5,6),m=102)
	mt.crate_row(ID=13,POS=(200,-.5,6.32),CNT=8,WAY=1,l=0,m=102)
	mt.crate_row(ID=13,POS=(200,-.5,6+.32*9),CNT=3,WAY=0,l=0,m=102)
	mt.crate_row(ID=13,POS=(200+.32*2,-.5,6+.32*10),CNT=5,WAY=1,l=0,m=102)
	mt.crate_row(ID=13,POS=(200-.32*2,-.5,14.5),CNT=5,WAY=1,l=0,m=102)
	mt.crate_row(ID=13,POS=(200-.32*2,-.5,14.5+.32*5),CNT=4,WAY=0,l=0,m=102)
	mt.crate_row(ID=13,POS=(200+.32*2,-.5,14.5+.32*5),CNT=7,WAY=1,l=0,m=102)
	mt.crate_row(ID=13,POS=(200-.32,-.5,21.5),CNT=7,WAY=1,l=0,m=102)
	mt.crate_row(ID=13,POS=(200-.32,-.5,21.5+.32*7),CNT=4,WAY=0,l=0,m=102)
	mt.crate_row(ID=13,POS=(200-.32+.32*3,-.5,21.5+.32*8),CNT=8,WAY=1,l=0,m=102)
	n.spawn(POS=(200,0,5),ID=13,DRC=1)
	n.spawn(POS=(200,0,16),ID=13,DRC=0)
	n.spawn(POS=(200,0,19.7),ID=13,DRC=0)
	n.spawn(POS=(200,0,23.7),ID=13,DRC=0)
	o.SewerEscape(pos=(200,-1,30),c=color.rgb32(0,200,180))
	o.SewerEntrance(pos=(200,1,27))
	o.SewerFloor(pos=(200,-.3,29.4))
	n.spawn(POS=(200,-.25,29),ID=11,DRC=0,RTYP=1)
	o.SewerWall(pos=(200,-1.7,33))
	if not 2 in status.COLOR_GEM:
		item.GemStone(c=2,pos=(200,0,28.9))
	o.GemPlatform(pos=(200,0,31.1),t=5)